<!DOCTYPE html>
<html>
<head>
  <title>chroma.js</title>
  <link rel="stylesheet" href="src/index.css">
</head>
<body><div class="wrap">
<h1 id="chroma-js">chroma.js</h1>
<p><strong>chroma.js</strong> is a tiny JavaScript library (12kB) for dealing with colors!</p>
<p><a href="https://travis-ci.org/gka/chroma.js"><img src="https://travis-ci.org/gka/chroma.js.svg?branch=master" alt="Build Status"></a></p>
<p>Here are a couple of things chroma.js can do for you:</p>
<ul>
<li>read colors from a wide range of formats</li>
<li>analyze and manipulate colors</li>
<li>convert colors into wide range of formats</li>
<li>linear and bezier interpolation in different color spaces</li>
</ul>
<p>Here&#39;s an example for a simple read / manipulate / output chain:</p>
<pre><code class="lang-js">chroma(&#39;pink&#39;).darken().saturate(2).hex()
</code></pre>
<p>Aside from that, chroma.js can also help you <strong>generate nice colors</strong> using various methods, for instance to be used in color palette for maps or data visualizations.</p>
<pre><code class="lang-js">chroma.scale([&#39;white&#39;,&#39;green&#39;,&#39;blue&#39;]).colors(5)
</code></pre>
<p>chroma.js has a lot more to offer, but that&#39;s the basic gist of it.</p>
<h2 id="reading-colors">Reading colors</h2>
<p>The first step is to get your color into chroma.js. That&#39;s what the generic constructor <code>chroma()</code> does. The function is trying to guess the color format for you. For instances, it will recognized any named color from the W3CX11 specification:   </p>
<pre><code class="lang-js">chroma(&#39;hotpink&#39;)
</code></pre>
<p>If there&#39;s no matching named color chroma.js checks for a <strong>hexadecimal string</strong>. It ignores case, the <code>#</code> sign is optional, and the shorter three letter format is recognized as well. So any of these are valid hexadecimal representations: <code>#ff3399</code>, <code>FF3399</code>, <code>#f39</code>, etc.</p>
<pre><code class="lang-js">chroma(&#39;#ff3399&#39;); 
chroma(&#39;F39&#39;);
</code></pre>
<p>In addition to hex strings, <strong>hexadecimal numbers</strong> (in fact, just any number between <code>0</code> and <code>16777215</code>), will be recognized, too.</p>
<pre><code class="lang-js">chroma(0xff3399)
</code></pre>
<p>If you pass the RGB channels individually, too. Each parameter must be within <code>0..255</code>. You can pass the numbers as individual arguments or as array.</p>
<pre><code class="lang-js">chroma(0xff, 0x33, 0x99);
chroma(255, 51, 153);
chroma([255, 51, 153]);
</code></pre>
<p>You can construct colors from different color spaces by passing the name of color space as the last argument. Here we define the same color in HSL by passing the h<em>ue angle (0-360) and percentages for </em>s<em>aturation and </em>l*ightness:</p>
<pre><code class="lang-js">chroma(330, 1, 0.6, &#39;hsl&#39;)
</code></pre>
<p>Alternatively, every color space has it&#39;s own constructor function under the <code>chroma</code> namespace. For a list of all supported color spaces, check the <a href="#supported-color-spaces-and-output-formats">appendix</a>.</p>
<pre><code class="lang-js">chroma.hsl(330, 1, 0.6)
</code></pre>
<h3 id="alpha-channel">Alpha channel</h3>
<p>You can always set the <code>opacity</code> using <code>.alpha()</code>, but before the color mode.</p>
<pre><code class="lang-js">chroma(&#39;red&#39;).alpha(0.5);
chroma(&#39;rgba(255,0,0,0.5)&#39;);
</code></pre>
<h2 id="analyze-and-manipulate-colors">Analyze and manipulate colors</h2>
<h3 id="change-brightness">Change brightness</h3>
<p>Once loaded, chroma.js can change colors. One way we already saw above, you can change the lightness.</p>
<pre><code class="lang-js">chroma(&#39;hotpink&#39;).darken();
chroma(&#39;hotpink&#39;).darken(2);
chroma(&#39;hotpink&#39;).brighten();
</code></pre>
<h3 id="change-saturation">Change saturation</h3>
<p>You can also <strong>saturate</strong> colors. chroma.js will use the <code>Lch</code> color space to saturate/desaturate the colors.</p>
<pre><code class="lang-js">chroma(&#39;slategray&#39;).saturate(); 
chroma(&#39;slategray&#39;).saturate(2);
</code></pre>
<p>You can <strong>desaturate</strong> colors, too. </p>
<pre><code class="lang-js">chroma(&#39;hotpink&#39;).desaturate();
chroma(&#39;hotpink&#39;).desaturate(3);
// destaturate is the same as negative saturation
chroma(&#39;hotpink&#39;).saturate(-3);
</code></pre>
<h3 id="set-get-generic-channels">Set/get generic channels</h3>
<p>Set a channel of a color space.</p>
<pre><code class="lang-js">// change hue to 0 deg
chroma(&#39;hotpink&#39;).set(&#39;hsl.h&#39;, 0);
// set chromacity to 30
chroma(&#39;hotpink&#39;).set(&#39;lch.c&#39;, 30);
</code></pre>
<p>Relative changes work, too:</p>
<pre><code class="lang-js">// half Lab lightness
chroma(&#39;orangered&#39;).set(&#39;lab.l&#39;, &#39;*0.5&#39;);
// double Lch saturation
chroma(&#39;darkseagreen&#39;).set(&#39;lch.c&#39;, &#39;*2&#39;);
</code></pre>
<h3 id="relative-luminance">Relative luminance</h3>
<p>Returns the relative brightness of any point in a colorspace, normalized to <code>0</code> for darkest black and <code>1</code> for lightest white according to the <a href="http://www.w3.org/TR/2008/REC-WCAG20-20081211/#relativeluminancedef">WCAG definition</a>.</p>
<pre><code class="lang-js">chroma(&#39;white&#39;).luminance();
chroma(&#39;aquamarine&#39;).luminance();
chroma(&#39;hotpink&#39;).luminance();
chroma(&#39;darkslateblue&#39;).luminance();
chroma(&#39;black&#39;).luminance();
</code></pre>
<p>chroma.js also allows you to <strong>set the luminance</strong> of a color. The source color will be interpolated with black or white until the correct luminance is found.</p>
<pre><code class="lang-js">// set lumincance to 50% for all colors
chroma(&#39;white&#39;).luminance(0.5);
chroma(&#39;aquamarine&#39;).luminance(0.5);
chroma(&#39;hotpink&#39;).luminance(0.5);
chroma(&#39;darkslateblue&#39;).luminance(0.5);
</code></pre>
<h3 id="contrast-ratio">Contrast ratio</h3>
<p>Computes the WCAG contrast ratio between two colors. A minimum contrast of 4.5:1 <a href="http://www.w3.org/TR/WCAG20-TECHS/G18.html">is recommended</a> to ensure that text is still readable against a background color.</p>
<pre><code class="lang-js">// contrast &lt; 4.5, too low
chroma.contrast(&#39;pink&#39;, &#39;hotpink&#39;);
// contrast &gt; 4.5 high enough
chroma.contrast(&#39;pink&#39;, &#39;purple&#39;);
</code></pre>
<h3 id="color-temperature">Color temperature</h3>
<p>light 2000K, bright sunlight 6000K. Based on <a href="https://github.com/neilbartlett/color-temperature">Neil Bartlett&#39;s implementation</a>. </p>
<pre><code class="lang-js">chroma.temperature(2000); // candle light
chroma.temperature(3500); // sunset
chroma.temperature(6000); // bright sunlight
</code></pre>
<p>The effective temperature range goes from <code>0</code> to about <code>20000</code> Kelvin:</p>
<pre><code class="lang-js">f = function(i) {
    return chroma.temperature(i * 20000)
}
</code></pre>
<p>You can also estimate the temperature of any given color, though this makes the only sense for colors from the temperature gradient above.</p>
<pre><code class="lang-js">chroma(&#39;#ff3300&#39;).temperature();
chroma(&#39;#ff8a13&#39;).temperature();
chroma(&#39;#ffe3cd&#39;).temperature();
chroma(&#39;#cbdbff&#39;).temperature();
chroma(&#39;#b3ccff&#39;).temperature();
</code></pre>
<h2 id="mixing-colors">Mixing colors</h2>
<p>Simplest way. Mix two colors can be achieved in multiple ways. Change the mix ratio by passing a value between 0 and 1 as third parameter. In the following example, red will be mixed with blue. </p>
<pre><code class="lang-js">chroma.mix(&#39;red&#39;, &#39;blue&#39;).hex();
chroma.mix(&#39;red&#39;, &#39;blue&#39;, 0.25).hex();
</code></pre>
<p>The color mixing produces different results based on what color space the colors are interpolated in. The default color space is <code>rgb</code> but in the following example we interpolate in <code>Lab</code> instead.  </p>
<pre><code class="lang-js">chroma.mix(&#39;red&#39;, &#39;blue&#39;, 0.5, &#39;rgb&#39;);
chroma.mix(&#39;red&#39;, &#39;blue&#39;, 0.5, &#39;hsl&#39;);
chroma.mix(&#39;red&#39;, &#39;blue&#39;, 0.5, &#39;lab&#39;);
chroma.mix(&#39;red&#39;, &#39;blue&#39;, 0.5, &#39;lch&#39;);
</code></pre>
<h3 id="blending-colors">Blending colors</h3>
<pre><code class="lang-js">chroma.blend(&#39;4CBBFC&#39;, &#39;EEEE22&#39;, &#39;multiply&#39;);
chroma.blend(&#39;4CBBFC&#39;, &#39;EEEE22&#39;, &#39;darken&#39;);
chroma.blend(&#39;4CBBFC&#39;, &#39;EEEE22&#39;, &#39;lighten&#39;);
chroma.blend(&#39;4CBBFC&#39;, &#39;EEEE22&#39;, &#39;screen&#39;);
chroma.blend(&#39;4CBBFC&#39;, &#39;EEEE22&#39;, &#39;overlay&#39;);
chroma.blend(&#39;4CBBFC&#39;, &#39;EEEE22&#39;, &#39;burn&#39;);
chroma.blend(&#39;4CBBFC&#39;, &#39;EEEE22&#39;, &#39;dodge&#39;);
</code></pre>
<h2 id="color-scales">Color scales</h2>
<p>A color scale, created with <code>chroma.scale</code>, is a function that maps numeric values to a color palette. The default scale has the domain <code>0..1</code> and goes from white to black.</p>
<pre><code class="lang-js">f = chroma.scale();
f(0.25);
f(0.5);
f(0.75);
</code></pre>
<p>You can pass an array of colors to <code>chroma.scale</code>. Any color that can be read by <code>chroma()</code> will work here, too. If you pass more than two colors, they will be evenly distributed along the gradient.</p>
<pre><code class="lang-js">chroma.scale([&#39;yellow&#39;, &#39;008ae5&#39;]);
chroma.scale([&#39;yellow&#39;, &#39;red&#39;, &#39;black&#39;]);
</code></pre>
<h3 id="custom-domain">Custom domain</h3>
<p>You can change the input domain to match your specific use case.</p>
<pre><code class="lang-js">// default domain is [0,1]
chroma.scale([&#39;yellow&#39;, &#39;008ae5&#39;])(0.5);
// set domain to [0,100]
chroma.scale([&#39;yellow&#39;, &#39;008ae5&#39;])
    .domain([0,100])(50);
</code></pre>
<p>You can change the input domain to match your specific use case.</p>
<pre><code class="lang-js">// default domain is [0,1]
chroma.scale([&#39;yellow&#39;, &#39;lightgreen&#39;, &#39;008ae5&#39;])
    .domain([0,0.25,1]);
</code></pre>
<h3 id="specifying-interplation-space">Specifying interplation space</h3>
<p>As with chroma.mix, the result of the interpolation will depend on the color mode.</p>
<pre><code class="lang-js">chroma.scale([&#39;yellow&#39;, &#39;008ae5&#39;]);
chroma.scale([&#39;yellow&#39;, &#39;008ae5&#39;]).mode(&#39;lab&#39;);
chroma.scale([&#39;yellow&#39;, &#39;008ae5&#39;]).mode(&#39;lch&#39;);
</code></pre>
<h3 id="lightness-correction">Lightness correction</h3>
<p>Sometimes</p>
<pre><code class="lang-js">chroma.scale([&#39;yellow&#39;, &#39;008ae5&#39;]).mode(&#39;lch&#39;);

chroma.scale([&#39;yellow&#39;, &#39;008ae5&#39;])
    .mode(&#39;lch&#39;)
    .correctLightness(1);
</code></pre>
<h3 id="bezier-interpolation">Bezier interpolation</h3>
<p><code>chroma.bezier</code> returns a function that performs a bezier interpolate. The input range of the function is <code>[0..1]</code>. Bezier interpolation is always done in <code>Lab</code> space.</p>
<pre><code class="lang-js">// linear interpolation
chroma.scale([&#39;white&#39;, &#39;yellow&#39;, &#39;red&#39;, &#39;black&#39;]);
// bezier interpolation
chroma.bezier([&#39;white&#39;, &#39;yellow&#39;, &#39;red&#39;, &#39;black&#39;]);
// convert bezier interpolator into chroma.scale
chroma.bezier([&#39;white&#39;, &#39;yellow&#39;, &#39;red&#39;, &#39;black&#39;])
    .scale().colors(6);
</code></pre>
<p>Bezier interpolation</p>
<h3 id="cube-helix">Cube-helix</h3>
<p>Dave Green&#39;s <a href="http://www.mrao.cam.ac.uk/~dag/CUBEHELIX/">cubehelix color scheme</a>!!</p>
<p>Parameters (description copied from Dave Green):</p>
<ul>
<li><strong>start</strong> color for <a href="http://en.wikipedia.org/wiki/Hue#/media/File:HueScale.svg">hue rotation</a>, default=<code>300</code></li>
<li><strong>rotation</strong>: number of rotations (e.g. 1=<code>360°</code>, 1.5=`540°``), default=-1.5</li>
<li><strong>hue</strong>: controls how saturated the colour of all hues are. either single value or range, default=1</li>
<li><strong>gamma factor</strong>: can be used to emphasise low or high intensity values, default=1</li>
<li><strong>lightness</strong> range: default: [0,1]  (black -&gt; white)</li>
</ul>
<pre><code class="lang-js">chroma.cubehelix().start(0);
chroma.cubehelix().start(50);
chroma.cubehelix().rotations(0.5);
// convert into chroma.scale
chroma.cubehelix().scale().colors(7);
</code></pre>
<h2 id="color-output">color output</h2>
<p>Finally, chroma.js allows you to output colors in various color spaces and formats. Most often you will want to output the color as hexadecimal string.</p>
<pre><code class="lang-js">chroma(&#39;orange&#39;).hex()
</code></pre>
<p><strong><code>name</code></strong> returns the named color or the hexadecimal string, if the color isn&#39;t present.</p>
<pre><code class="lang-js">chroma(&#39;#ffa500&#39;).name()
</code></pre>
<p><strong><code>rgb</code></strong> returns an array with the <strong>r</strong>ed, <strong>b</strong>lue, and <strong>g</strong>reen component, each as number between 0 and 255.</p>
<pre><code class="lang-js">chroma(&#39;orange&#39;).rgb()
</code></pre>
<p><strong><code>hsl</code></strong> returns an array with the <strong>h</strong>ue, <strong>s</strong>aturation, and <strong>l</strong>ightness component, each as number between 0 and 255. Note that for hue-less colors (black, white, and grays), the hue component will be NaN.</p>
<pre><code class="lang-js">chroma(&#39;orange&#39;).hsl()
</code></pre>
<pre><code class="lang-js">chroma(&#39;white&#39;).hsl()
</code></pre>
<p><strong><code>hsv</code></strong> returns an array with the <strong>h</strong>ue, <strong>s</strong>aturation, and <strong>v</strong>alue component, each as number between 0 and 255. Note that for hue-less colors (black, white, and grays), the hue component will be NaN.</p>
<pre><code class="lang-js">chroma(&#39;orange&#39;).hsv()
</code></pre>
<p><strong><code>lab</code></strong> returns an array with the <strong>L</strong>, <strong>a</strong>, and <strong>b</strong> component, each as number between 0 and 255.</p>
<pre><code class="lang-js">chroma(&#39;orange&#39;).lab()
</code></pre>
<p><strong>luminance</strong> </p>
<pre><code class="lang-js">chroma(&#39;orange&#39;).luminance()
</code></pre>
<p><strong>temperature</strong> </p>
<pre><code class="lang-js">chroma(&#39;pink&#39;).temperature()
</code></pre>
<p>If the output color format is returned as separate channels, you can access them both using numeric and named indexes:</p>
<pre><code>color.rgb()[0]      // 255
color.rgb().r       // 255
color.rgb().red     // 255
</code></pre><p>For a complete list of supported output formats, read the <a href="">API docs</a>.</p>
<h2 id="supported-color-spaces-and-output-formats">Supported color spaces and output formats</h2>
<p>What follows is a complete list of all supported color spaces and formats.</p>
<h3 id="rgb">RGB</h3>
<p><strong>r</strong>ed, <strong>g</strong>reen, <strong>b</strong>lue, each between 0 and 255.</p>
<pre><code class="lang-js">chroma(200, 0, 30);
chroma.rgb(0.2, 0.8, 0, 0);
chroma(0.2, 0.8, 0, 0, &#39;rgb&#39;);
</code></pre>
<pre><code class="lang-js">chroma(&#39;lime&#39;).rgb()
</code></pre>
<p>Another way to input and output RGB colors is as <em>hexadecimal</em> strings:</p>
<pre><code class="lang-js">chroma(&#39;#EE5500&#39;);
chroma.hex(&#39;#EE5500&#39;);
</code></pre>
<pre><code class="lang-js">chroma(&#39;hotpink&#39;).hex()
</code></pre>
<p>Another way to input and output RGB colors is as <em>hexadecimal</em> strings:</p>
<pre><code class="lang-js">chroma(0xEE5500);
chroma.num(0xEE5500);
</code></pre>
<pre><code class="lang-js">chroma(&#39;hotpink&#39;).num()
</code></pre>
<h3 id="cmyk">CMYK</h3>
<p><strong>c</strong>yan, <strong>m</strong>agenta, <strong>y</strong>ellow, <strong>b</strong>lack, each between 0 and 1.</p>
<pre><code class="lang-js">chroma.cmyk(0.2, 0.8, 0, 0);
chroma(0.2, 0.8, 0, 0, &#39;cmyk&#39;);
</code></pre>
<pre><code class="lang-js">chroma(&#39;lime&#39;).cmyk()
</code></pre>
<h3 id="hsl">HSL</h3>
<p><strong>h</strong>ue (0-360), <strong>s</strong>aturation (0-1), <strong>l</strong>ightness (0-1).</p>
<pre><code class="lang-js">chroma.hsl(60, 0.8, 0.5);
chroma(60, 0.8, 0.5, &#39;hsl&#39;);
</code></pre>
<pre><code class="lang-js">chroma(&#39;tomato&#39;).hsl()
</code></pre>
<h3 id="hsv">HSV</h3>
<p><strong>h</strong>ue (0-360), <strong>s</strong>aturation (0-1), <strong>v</strong>alue (0-1).</p>
<pre><code class="lang-js">chroma.hsv(60, 0.8, 0.8);
chroma(60, 0.8, 0.8, &#39;hsv&#39;);
</code></pre>
<pre><code class="lang-js">chroma(&#39;tomato&#39;).hsv()
</code></pre>
<h3 id="hsi">HSI</h3>
<p><strong>h</strong>ue (0-360), <strong>s</strong>aturation (0-1), <strong>i</strong>ntensity (0-1).</p>
<pre><code class="lang-js">chroma.hsi(60, 0.8, 0.8);
chroma(60, 0.8, 0.8, &#39;hsi&#39;);
</code></pre>
<pre><code class="lang-js">chroma(&#39;tomato&#39;).hsi()
</code></pre>
<h3 id="lab">Lab</h3>
<p><strong>L</strong>ightness (0-100), <strong>a</strong> (-100 - 100), <strong>b</strong> (-100 - 100).</p>
<pre><code class="lang-js">chroma.lab(80, 40, 130);
chroma(80, 40, 130, &#39;lab&#39;);
</code></pre>
<pre><code class="lang-js">chroma(&#39;cyan&#39;).lab()
</code></pre>
<h3 id="lch">Lch</h3>
<p><strong>L</strong>ightness, <strong>c</strong>hroma (0-1), <strong>h</strong>ue (0-1).</p>
<pre><code class="lang-js">chroma.lch(80, 40, 130);
chroma(80, 40, 130, &#39;lch&#39;);
</code></pre>
<pre><code class="lang-js">chroma(&#39;tomato&#39;).lch()
</code></pre>
<h3 id="hcl">HCL</h3>
<p><strong>HCL</strong>: Btw, if you prefer, you can use <strong>hcl</strong> instead of Lch, too. It is all the same, except that lightness and hue channels are switched to be more consistent with HSL.</p>
<pre><code class="lang-js">chroma.hcl(130, 40, 80);
chroma(130, 40, 80, &#39;hcl&#39;);
</code></pre>
<pre><code class="lang-js">chroma(&#39;tomato&#39;).hcl()
</code></pre>
<h3 id="css">CSS</h3>
<p><strong>CSS</strong> If you pass a string that does not look like a hexadecimal color, chroma.js will try to parse it as CSS-color, either as <code>rgb()</code>, <code>rgba()</code>, <code>hsl()</code>, or <code>hsla()</code>.</p>
<pre><code class="lang-js">chroma(&#39;rgb(255,51,153)&#39;)
</code></pre>
<pre><code class="lang-js">chroma(&#39;hsla(330,100%,60%,0.5)&#39;)
</code></pre>
<p>You can access the alpha channel using <code>alpha()</code>.</p>
<pre><code class="lang-js">chroma(&#39;hsla(330,100%,60%,0.5)&#39;).alpha()
</code></pre>
<h3 id="gl">GL</h3>
<p><strong>GL</strong> is a variant of RGB(A), with the only difference that the components are normalized to the range of <code>0..1</code>.</p>
<pre><code class="lang-js">chroma.gl(0.2, 0.8, 0);
chroma(0.2, 0.8, 0, &#39;gl&#39;);
</code></pre>
<pre><code class="lang-js">chroma(&#39;33cc00&#39;).gl();
</code></pre>
<p>sdsd</p>

<link rel="stylesheet" type="text/css" href="vendor/codemirror/lib/codemirror.css"> 
<script type="text/javascript" src="vendor/jquery/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="vendor/chroma-js/chroma.min.js"></script>
<script type="text/javascript" src="vendor/codemirror/lib/codemirror.js"></script>
<script type="text/javascript" src="vendor/codemirror/mode/javascript/javascript.js"></script>

<script type="text/javascript">
    
    $('code.lang-js').each(function() {
        
        var code = this;
        
        var cm = CodeMirror(function(elt) {
            code.parentNode.replaceChild(elt, code);
            }, {
                value: code.innerHTML.trim(),
                indentUnit: 4,
                mode: 'javascript'
            });

        cm.on('update', function(_cm, change) {
            showColors(_cm);
        });

        var resDisplay = $('<div class="result-display" />')
            .appendTo(cm.display.wrapper.parentNode);

        showColors(cm);

        function showColors(cm) {
            $('.cm-string', cm.display.wrapper).each(styleSpan);
            $('.cm-number', cm.display.wrapper).each(enableSlider);

            // evaluate script
            var src = cm.getDoc().getValue();
            //resDisplay.html('');
            try {

                var s = src.split(';').map(eval);
                resDisplay.html(s.map(resRec)
                    .filter(function(d) { return d !== undefined; })
                    .join(','));

                $('.cm-string', resDisplay).each(styleSpan);

            } catch (e) {
                // console.warn(e);
            }

            function resRec(d) {
                if ($.isArray(d)) {
                    return '['+d.map(d.length > 2 ? resShort : resLong).join(',')+']';
                }
                return resLong(d);

                function resLong(d) {
                    if (typeof d == 'string') {
                        // string color, e.g. hex value
                        return '<span class="cm-string">"'+d+'"</span>';
                    } else if (typeof d == 'object' && d._rgb) {
                        // chroma.js object
                        return '<span class="cm-string cm-color" data-color="'+d.css()+'">'+d.hex()+'</span>';                 
                    } else if ($.isNumeric(d)) {
                        return '<span class="cm-number">'+round(d,3)+'</span>';
                    } else if ($.isFunction(d)) {
                        var s = '';
                        for (var i=0;i<=100;i++) {
                            s += '<span class="grad-step" style="background-color:'+d(i/100)+'"></span>';
                        }
                        return s;
                    }
                }

                function resShort(d) {
                    if (typeof d == 'string') {
                        // string color, e.g. hex value
                        return '<span class="cm-string cm-color" data-color="'+d+'"></span>';
                    } else if (typeof d == 'object' && d._rgb) {
                        // chroma.js object
                        return '<span class="cm-string cm-color" data-color="'+d.css()+'"></span>';                 
                    } else if ($.isNumeric(d)) {
                        return '<span class="cm-number">'+round(d,2)+'</span>';
                    } else if (isNaN(d)) {
                        return '<span class="cm-number cm-nan">NaN</span>';
                    }
                }
                
                function round(d, p) {
                    var n = Math.pow(10, p);
                    return Math.round(d*n) / n;
                }
            }
        }

        function styleSpan() {
            var span = $(this);
            //setTimeout(function() {
                val = span.data('color') || span.html().replace(/['"]/g, '').trim();
                if (chroma[val]) {
                    span.attr('style', '');
                    return;
                }
                        
                try {
                    var col = chroma(val),
                        l = col.luminance();
                    span.attr('style', [
                        'background-color:'+col.hex(),
                        'color:'+(l <0.5 ? 'white' : 'black'),
                        'opacity:'+col.alpha()
                    ].join(';'));                    
                } catch (e) {
                    //console.log(e);
                    span.attr('style', '');
                    // not a color, so ignore
                }
            //}, 50);
        }

        function enableSlider() {
            return;
            var span = $(this),
                slider = $('<div></div>').addClass('slider'),
                input = $('<input type="range" />').appendTo(slider);
            
            span.off('mouseenter').on('mouseenter', function() {
                var v = +span.text(),
                    d = Math.pow(10, Math.max(1, Math.log10(v))),
                    min = v - d,
                    max = v + d;
                input.attr({ min: min, max: max })
                    .prop('value', v);
                console.log('span', v);

                span.append(slider);
            });
            span.off('mouseleave').on('mouseleave', function() {
                //slider.remove();
            });
        }

    });

    var toc = $('<ul />')
        .addClass('toc')
        .appendTo(
            $('<div>')
            .addClass('toc-container')
            .appendTo('.wrap')
        );

    toc.append('<li><a href="#chroma-js">top</a></li>');

    $('h2,h3').each(function() {
        var h = $(this),
            l = h.attr('id'),
            t = h.is('h2');
        toc.append('<li class="'+('level-'+(t ? '1' : '2'))+'"><a href="#'+l+'">' + h.text() +'</a></li>');
    });
</script>
</div></body>
<html>
